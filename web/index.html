<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Title</title>
</head>
<body>


<button id="start">加入房间</button>
<button id="hangup">hangup</button>

<br>
<video id="local-video" autoplay="autoplay" playsinline="true" controls muted ></video>
<video id="remote-video"  playsinline="true" autoplay="autoplay" controls></video>



<script src="assets/js/app.js"></script>
<script src="assets/js/socket.js"></script>
<script src="assets/js/peer.js"></script>
<script src="assets/js/helper.js"></script>

<script>

    window.onload=function () {
        const url = (window.location.protocol==='http:'?'ws':"wss")+"://"+window.location.host+"/wss"
        const params = new URLSearchParams(document.location.search)

        if (params.get("uid")===null || params.get("uid")===""){
            alert("uid 参数为空")
            return
        }


        if (params.get("roomid")===null || params.get("roomid")===""){
            alert("roomid 参数为空")
            return
        }


        const start = document.querySelector("#start")
        const hangup = document.querySelector("#hangup")
        const localVideo = document.querySelector("#local-video")
        const remoteVideo = document.querySelector("#remote-video")

        const  app =new App();
        app.Socket(url,params.get("uid"),params.get("roomid"))

        app.RunPeer(localVideo,remoteVideo)

        //登录
        start.addEventListener("click", e=>{
            app.Join()
        })
        hangup.addEventListener("click",e=>app.close())

        app.bindSocketEvent("close",()=>app.close())
        app.bindSocketEvent("error",(event)=>console.log(event))


        app.bindSocketEvent("message",(type,room,uid,data)=>{handMessage(type,room,uid,data)})
        function handMessage(type,room,uid,data){
            switch (type) {
                case  ROOM_JOIN:
                    app.createOffer()
            }

        }

    }



</script>
</body>
</html>